<!DOCTYPE html>
<html lang="es">

<head>
	<title>Formularios</title>
	<!-- Required meta tags -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<script src="https://unpkg.com/pdf-lib@1.4.0"></script>
	<script src="https://unpkg.com/downloadjs@1.4.7"></script>

	<!-- Bootstrap CSS v5.2.1 -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
	<!-- Estilos base  -->
	<link rel="stylesheet" href="assets/css/styles.css" />
</head>

<body>
	<header>
		<!-- <nav class="navbar navbar-expand navbar-light bg-light">
                <div class="nav navbar-nav">
                    <a class="nav-item nav-link active" href="#" aria-current="page">Home <span class="visually-hidden">(current)</span></a>
                    <a class="nav-item nav-link" href="#">Home</a>
                </div>
            </nav> -->
	</header>
	<main>
		<div class="d-flex justify-content-center animate__animated animate__fadeInDown animate__delay-1s">
			<div class="w-100 shadow-sm rounded border m-5 formulario_politica">
				<h1 class="text-center m-5">Formulario de vinculación</h1>
				<hr class="mx-5" />
				<form method="POST" action="php/post_form.php" class="m-5 needs-validation" enctype="multipart/form-data">
					<div class="row">
						<div
							class="col border m-2 rounded shadow animate__animated animate__fadeInUp animate__delay-2s partido_politico">
							<h2 class="text-center m-5">Colectividad</h2>
							<hr class="mx-5" />
							<div class="partido_politico text-center overflow-auto" id="partido_politico"></div>
						</div>
						<div
							class="col border m-2 rounded shadow animate__animated animate__fadeInUp animate__delay-3s">
							<div class="datos-formulario">
								<h2 class="text-center">
									Datos del Solicitante
								</h2>
								<hr class="mx-5" />
								<div class="mb-3">
									<!-- aspirante o militante -->
									<label for="aspirante_militante" class="form-label">Aspirante o Militante
										<small style="color: red">*</small></label>
									<select name="aspira_militante" id="aspirante_militante" class="form-select"
										required>
										<option value="" selected disabled hidden>
											Aspirante o Militante
										</option>
										<option value="aspirante">
											Aspirante
										</option>
										<option value="militante">
											Militante
										</option>
										<option value="ambos">Ambos</option>
									</select>
								</div>
								<div class="mb-3 d-none" id="aspirante">
									<label for="cargo_asp" class="form-label">
										Cargo al que aspira
										<small style="color: red">*</small>
									</label>
									<select name="cargo_asp" id="cargo_asp" class="form-select" required>
										<option value="" selected disabled hidden>
											Cargo al que aspira
										</option>
										<option value="JAL">JAL</option>
										<option value="CONCEJO">
											CONCEJO
										</option>
										<option value="ALCALDÍA">
											ALCALDÍA
										</option>
										<option value="ASAMBLEA">
											ASAMBLEA
										</option>
										<option value="GOBERNACIÓN">
											GOBERNACIÓN
										</option>
										<option value="CMJ">CMJ</option>
									</select>
								</div>
								<div class="mb-3 d-none" id="militante">
									<label for="info_militante" class="form-label">Actividades que desea realizar como
										militante
										<small style="color: red">*</small></label>
									<textarea name="info_militante" id="info_militante" cols="30" rows="5"
										class="form-control" required></textarea>
								</div>
								<div class="mb-3">
									<label for="tipo_doc" class="form-label">Tipo de Documento
										<small style="color: red">*</small></label>
									<select name="tipo_doc" id="tipo_doc" class="form-select" required>
										<option value="" selected disabled hidden>
											Tipo de Documento
										</option>
										<option value="CC">
											Cédula de ciudadanía
										</option>
										<option value="CE">
											Cédula de extranjería
										</option>
										<option value="PP">
											Pasaporte
										</option>
										<option value="TI">
											Tarjeta de Identidad
										</option>
									</select>
								</div>

								<div class="mb-3">
									<label for="num_identificacion" class="form-label">Número de Identificación
										<small style="color: red">*</small></label>
									<input name="num_doc" required type="number" class="form-control"
										id="num_identificacion" placeholder="Número de Identificación" />
								</div>
								<div class="mb-3">
									<label for="fecha_exp" class="form-label">Fecha de expedición del
										documento<small style="color: red">*</small></label>
									<input name="fecha_exp" required type="date" class="form-control" id="fecha_exp" />
								</div>
								<div class="mb">
									<label for="ciudad_exp" class="form-label">Ciudad de expedición<small
											style="color: red">*</small></label>
									<input name="ciudad_exp" required type="text"
										placeholder="Ciudad de expedición del documento" class="form-control"
										id="ciudad_exp" />
								</div>
								<div class="mb-3">
									<label for="nombre" class="form-label">Nombres<small
											style="color: red">*</small></label>
									<input name="nombres" required type="text" class="form-control" id="nombre"
										placeholder="Nombres" />
								</div>
								<div class="mb-3">
									<label for="apellido" class="form-label">Apellidos<small
											style="color: red">*</small></label>
									<input name="apellidos" required type="text" class="form-control" id="apellido"
										placeholder="Apellidos" />
								</div>
								<div class="mb-3">
									<label for="genero" class="form-label">Género<small
											style="color: red">*</small></label>
									<select name="genero" id="genero" class="form-select" required>
										<option value="" selected disabled hidden>
											Género
										</option>
										<option value="M">Masculino</option>
										<option value="F">Femenino</option>
									</select>
								</div>

								<div class="mb-3">
									<label for="fecha_nacimiento" class="form-label">Fecha de Nacimiento<small
											style="color: red">*</small></label>
									<input name="fecha_nacimiento" required type="date" class="form-control"
										id="fecha_nacimiento" />
								</div>
								<div class="mb-3">
									<label for="n_educativo" class="form-label">Nivel Educativo
										<small style="color: red">*</small>
									</label>
									<select name="n_educativo" id="n_educativo" class="form-select" required>
										<option value="" selected disabled hidden>
											Estudios
										</option>
										<option value="Básica primaria">
											Básica Primaria
										</option>
										<option value="Básica secundaria">
											Básica Secundaria
										</option>
										<option value="Media">Media</option>
										<option value="Ténica">
											Técnica
										</option>
										<option value="Profesional">
											Profesional
										</option>
										<option value="Especialización">
											Especialización
										</option>
										<option value="Maestría">
											Maestría
										</option>
										<option value="Doctorado">
											Doctorado
										</option>
									</select>
								</div>
								<div class="mb-3">
									<label for="oficio" class="form-label">Oficio<small
											style="color: red">*</small></label>
									<input name="oficio" required type="text" class="form-control" placeholder="Oficio"
										id="oficio" />
								</div>
								<div class="mb-3">
									<label for="poblacion" class="form-label">Tipo de Población<small
											style="color: red">*</small></label>
									<select name="poblacion" id="poblacion" class="form-select" required>
										<!-- poblacion -->
										<option value="" selected disabled hidden>
											Población
										</option>
										<option value="General">
											General
										</option>
										<option value="Afrodescendiente">
											Afrodescendiente
										</option>
										<option value="Indígena">
											Indígena
										</option>
										<option value="Raizal">
											Raizal
										</option>
										<option value="RROM">RROM</option>
									</select>
								</div>
								<div class="mb-3">
									<label for="numero_celular" class="form-label">Número de celular<small
											style="color: red">*</small></label>
									<input required type="number" class="form-control" id="numero_celular"
										name="celular" placeholder="Número de celular" />
								</div>
								<div class="mb-3">
									<label for="email" class="form-label">Correo Electrónico<small
											style="color: red">*</small></label>
									<input required type="email" name="email" id="email" class="form-control"
										placeholder="Correo Electrónico" />
								</div>
								<div class="mb-3">
									<label for="pais" class="form-label">País<small style="color: red">*</small></label>
									<input name="pais" required type="text" class="form-control" id="pais"
										placeholder="País" />
								</div>
								<div class="mb-3" class="form-label">
									<label for="departamentos">Departamento<small style="color: red">*</small></label>
									<select name="departamento" class="form-select" id="departamentos"
										required></select>
								</div>
								<div class="mb-3" class="form-label">
									<label for="municipios">Municipio<small style="color: red">*</small></label>
									<select name="municipio" class="form-select" id="municipios" required></select>
								</div>
								<div class="mb-3" class="form-label">
									<label for="direccion">Dirección de la residencia<small
											style="color: red">*</small></label>
									<input required type="text" name="direccion" class="form-control"
										placeholder="Dirección de la residencia" />
								</div>
								<div class="mb-3" class="form-label">
									<label for="localidad">Localidad<small style="color: red">*</small></label>
									<input name="localidad" required type="text" class="form-control" id="localidad"
										placeholder="Localidad o comuna" />
								</div>
								<div class="mb-3" class="form-label">
									<label for="archivo">Cargar documento, con el número de la cedula en formato pdf</label>
									<!-- only pdf -->
									<input accept="application/pdf" name="archivo" type="file" class="form-control" id="archivo"
										placeholder="archivo"/>
								</div>
								<button type="submit" class="btn btn-primary w-100">
									Enviar
								</button>
							</div>
						</div>
					</div>
					<a href="#" id="boton_descargar" class="btn btn-primary">Descargar pdf</a>
				</form>
			</div>
		</div>
	</main>
	<footer>
		<!-- place footer here -->
	</footer>
	<script src="https://code.jquery.com/jquery-3.6.4.min.js"
		integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
	<script src="assets/js/main.js"></script>
	<!-- Bootstrap JavaScript Libraries -->
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
		integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
		crossorigin="anonymous"></script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
		integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz"
		crossorigin="anonymous"></script>
	<script>
		const { PDFDocument, StandardFonts, rgb } = PDFLib
		$(document).ready(function() {
			$('#boton_descargar').on('click', function() {
				// el src del logo se obtiene de input radio que se alla seleccionado
			
				var imagenSeleccionada = $('input[name="partido_politico"]:checked').siblings('label').find('img').attr('src');
				var partido_politico = $('input[name="partido_politico"]').val();
				var aspira_militante = $('select[name="aspira_militante"]').val();
				var cargo_asp = $('select[name="cargo_asp"]').val();
				var info_militante = $('input[name="info_militante"]').val();
				var tipo_doc = $('select[name="tipo_doc"]').val();
				var num_doc = $('input[name="num_doc"]').val();
				var fecha_exp = $('input[name="fecha_exp"]').val();
				var ciudad_exp = $('input[name="ciudad_exp"]').val();
				var nombres = $('input[name="nombres"]').val();
				var apellidos = $('input[name="apellidos"]').val();
				var genero = $('select[name="genero"]').val();
				var fecha_nacimiento = $('input[name="fecha_nacimiento"]').val();
				var n_educativo = $('select[name="n_educativo"]').val();
				var oficio = $('input[name="oficio"]').val();
				var poblacion = $('select[name="poblacion"]').val();
				var celular = $('input[name="celular"]').val();
				var email = $('input[name="email"]').val();
				var pais = $('input[name="pais"]').val();
				var departamento = $('select[name="departamento"]').val();
				var municipio = $('select[name="municipio"]').val();
				var direccion = $('input[name="direccion"]').val();
				var localidad = $('input[name="localidad"]').val();
				console.log(aspira_militante);
				console.log(imagenSeleccionada);
				console.log(partido_politico);
				console.log(aspira_militante);
				console.log(cargo_asp);
				console.log(info_militante);
				console.log(tipo_doc);
				console.log(num_doc);
				console.log(fecha_exp);
				console.log(ciudad_exp);
				console.log(nombres);
				console.log(apellidos);
				console.log(genero);
				console.log(fecha_nacimiento);
				console.log(n_educativo);
				console.log(oficio);
				console.log(poblacion);
				console.log(celular);
				console.log(email);
				console.log(pais);
				console.log(departamento);
				console.log(municipio);
				console.log(direccion);
				console.log(localidad);
				if (aspira_militante == "aspirante" || aspira_militante == "ambos"){
					createPdf(
						imagenSeleccionada,
						partido_politico,
						aspira_militante,
						cargo_asp,
						// info_militante,
						tipo_doc,
						num_doc,
						fecha_exp,
						ciudad_exp,
						nombres,
						apellidos,
						genero,
						fecha_nacimiento,
						n_educativo,
						oficio,
						poblacion,
						celular,
						email,
						pais,
						departamento,
						municipio,
						direccion,
						localidad
					)
				}else{
					alert("El pdf no esta disponible para militante")
				}
			});
		});

		


		
		
		

		async function createPdf(
			logo,
			partido_politico,
			aspira_militante,
			cargo_asp,
			// info_militante,
			tipo_doc,
			num_doc,
			fecha_exp,
			ciudad_exp,
			nombres,
			apellidos,
			genero,
			fecha_nacimiento,
			n_educativo,
			oficio,
			poblacion,
			celular,
			email,
			pais,
			departamento,
			municipio,
			direccion,
			localidad

		) {
			const templateBytes = await fetch('formulario.pdf').then(res => res.arrayBuffer())
			const pdfDoc = await PDFDocument.load(templateBytes)
			// obtener el tamaño de las paginas
			
			const paginas = pdfDoc.getPages()
			const firstPage = paginas[0]
			const timesRomanFont = await pdfDoc.embedFont(StandardFonts.TimesRoman)
			const size = firstPage.getSize()
			// colocar la imagen en el pdf cors habilitado
			
			const pngImageBytes = await fetch(logo).then(res => res.arrayBuffer())
			// habilitar cors en el servidor
			const image = await pdfDoc.embedPng(pngImageBytes)
			const { width, height } = image.scale(0.5)
			firstPage.drawImage(image, {
				x: firstPage.getWidth() / 2 - width / 2,
				y: firstPage.getHeight() - height - 50,
				width,
				height
			})
			// firstPage.drawText('¡Hola, mundo!', { x: 200, y: 500, font: timesRomanFont, size: 24 })
			// añadir los datos de la variable al pdf
			// nombre completo
			const nombre_completo = nombres + ' ' + apellidos
			// Primer nivel
			// firstPage.drawText(aspira_militante.toString(), { x: 100, y: 200, font: timesRomanFont, size: 12 })
			firstPage.drawText(nombre_completo.toString(), { x: 210, y: 640, font: timesRomanFont, size: 12 })
			firstPage.drawText(cargo_asp.toString(), { x: 40, y: 640, font: timesRomanFont, size: 12 })
			tipo_numdoc = tipo_doc + ' ' + num_doc
			// Segundo nivel
			firstPage.drawText(tipo_numdoc.toString(), { x: 40, y: 600, font: timesRomanFont, size: 12 })
			firstPage.drawText(fecha_exp.toString(), { x: 210, y: 600, font: timesRomanFont, size: 12 })
			firstPage.drawText(ciudad_exp.toString(), { x: 390, y: 600, font: timesRomanFont, size: 12 })
			// Tercer nivel
			firstPage.drawText(genero.toString(), { x: 40, y: 550, font: timesRomanFont, size: 12 })
			firstPage.drawText(fecha_nacimiento.toString(), { x: 210, y: 550, font: timesRomanFont, size: 12 })
			firstPage.drawText(n_educativo.toString(), { x: 390, y: 550, font: timesRomanFont, size: 12 })
			// Cuarto nivel
			firstPage.drawText(oficio.toString(), { x: 40, y: 510, font: timesRomanFont, size: 12 })
			firstPage.drawText(poblacion.toString(), { x: 210, y: 510, font: timesRomanFont, size: 12 })
			firstPage.drawText(celular.toString(), { x: 390, y: 510, font: timesRomanFont, size: 12 })
			// Quinto nivel
			firstPage.drawText(email.toString(), { x: 40, y: 465, font: timesRomanFont, size: 12 })
			firstPage.drawText(pais.toString(), { x: 210, y: 465, font: timesRomanFont, size: 12 })
			firstPage.drawText(departamento.toString(), { x: 390, y: 465, font: timesRomanFont, size: 12 })
			// Sexto nivel
			firstPage.drawText(municipio.toString(), { x: 40, y: 420, font: timesRomanFont, size: 12 })
			firstPage.drawText(direccion.toString(), { x: 210, y: 420, font: timesRomanFont, size: 12 })
			firstPage.drawText(localidad.toString(), { x: 390, y: 420, font: timesRomanFont, size: 12 })

			
			const pdfBytes = await pdfDoc.save()
			// colocar al pdf el numero de documento para que se abra con ese nombre


			const url = URL.createObjectURL(new Blob([pdfBytes], { type: 'application/pdf' }))
			window.open(url, '_blank')

			
			


			// download(pdfBytes, 'formulario_llenado.pdf', 'application/pdf')
		}
	</script>
</body>

</html>